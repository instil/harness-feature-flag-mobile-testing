apply plugin: "com.android.model.library"
apply plugin: "jacoco"
apply from: "${project.rootDir}/gradle/static-analysis.gradle"

model {
    android {
        compileSdkVersion = 23
        buildToolsVersion = "23.0.3"

        defaultConfig {
            minSdkVersion.apiLevel 19
            targetSdkVersion.apiLevel 23
            versionCode 1
            versionName "1.0"
        }
    }

    android.sources {
        main {
            jni {
                source {
                    srcDirs = ["../../core/src", "../../core/lib/RxCpp/Rx/v2/src", "src/main/jni"]
                }
            }
        }
    }

    android.ndk {
        moduleName "surge"
        cppFlags.add("-std=c++11")
        cppFlags.add("-fexceptions")
        cppFlags.add("-I" + file("../../core/lib/RxCpp/Rx/v2/src"))
        cppFlags.add("-I" + file("../../core/src"))
        ldLibs.addAll(["log"])
        stl "c++_shared"
    }

    android.buildTypes {
        debug {
            testCoverageEnabled = true
        }
        release {
            minifyEnabled = false
            proguardFiles.add(file("proguard-rules.pro"))
        }
    }
}

ext.includeLibsFolder = 'libs'
task copyLibs(type: Copy, dependsOn: 'cleanLibs') {
    from configurations.compile
    into includeLibsFolder
}

task cleanLibs(type: Delete) {
    delete includeLibsFolder
}

dependencies {
    compile fileTree(dir: includeLibsFolder, include: ["*.jar"])
    compile "com.android.support:appcompat-v7:23.4.0"
    compile "org.slf4j:slf4j-api:1.7.21"

    testCompile "junit:junit:4.12"
    testCompile "org.easymock:easymock:3.4"
}
